---
layout: "@layouts/MarkdownPostLayout.astro"
title: ZJUT-PC端闪讯与内网共存
author: J10c
pubDate: 2021-09-11
tags: ["programming"]
---

## 背景

看到朵朵里面好多人在商量电信转移动的事情，心里很难受。要知道校外电信口碑碾压移动，在校内，一次选课后，电信怎么就爆炸了呢？

跨专业学习了一下，终于搓出了这份教程💦💦💦

## 约定

1.  你的电脑应该至少有两张网卡，一张有线，一张无线（说人话就是能既插网线又能连WIFI，拓展坞实现插网线的也可以，一般的笔记本都能满足要求）
2.  本教程适用于Windows系统，在 Windows10 21H1 和 20H2版本上已经成功，MacOS 也能实现，把 Powershell 的命令转译成 bash 就行了，当然欢迎 Linux 用户来捧场，会手动拨号了改个路由表应该不在话下。
3.  对于已经使用了 OpenWrt 通过 WIFI 访问外网的电信用户，在客户端上你需要**两张**无线网卡，也可以在路由器上按教程中的原理配置。
4.  嫌麻烦的看完**单独访问内网**就可以结束了，以后用内网先要断闪讯，插移动专用网口，或者连 **Wlan-edu**。
5.  有什么问题邮箱（网页底部）找我，看到了就回。

## 单独访问内网

先从寝室里单独使用内网说起吧，好多人 ~~（助班）~~ 都不知道电信用户能在寝室访问内网，电脑有两种方式，手机有一种：

1.  电脑断开所有网络的有线连接（闪讯）和无线连接，WIFI 连接 **Wlan-edu**，随便访问一个内网 IP（如`192.168.1.1`），会出现登录页面，输入账号密码，选择校园网，登录成功即可。~~这样子网速稍微慢一点~~
    
2.  电脑插墙壁上比较新的网口（就是移动用户上网插的网口），随便访问一个内网 IP（如`192.168.1.1`），会跳转到登录页面，登录成功即可。~~这样访问内网最快的！~~
    
3.  手机不需要关闭流量开关，WIFI 连接 **Wlan-edu**，随便访问一个内网 IP（如`192.168.1.1`），会出现登录页面，登录成功即可。
    
    > 第一次登录宿舍楼（梦溪）校园网`Wlan-edu`，账号是学号，密码是身份证后8位，登录成功会提示去自助服务平台开通，在 Dr.COM 那个页面输入同样的账号密码，成功登录后会发现账号状态默认停机，右侧业务办理处点击“用户注册开通”链接，弹出什么责任书，同意然后输入短信验证码，就登录成功了，接下来弹出一个页面，里面有两个选项，不用管他，回到Dr.com这个页面，刷新一下，看到账户状态是在线的就行了，然后就能访问内网了。 **图文可见 [小和山校园网 9 月 11 日发表的文章](https://mp.weixin.qq.com/s/DIup5mkQXN5GCoYkn5ef6w)**
    
    > 第一次登录教学区校园网`Zjut-stu`，账号是学号，密码是身份证后8位，登录成功会提示去自助服务平台开通，此时的办理页面不再是 Dr.COM 了，点击办理，出现“已处理”提示，但只停留在**步骤一**，无法继续执行。正确的方式应是去**工大企业号（微门户）办事大厅**申请 **“学生校园网账号办理”** ，此时你的手机应该只打开了流量开关，而 WIFI 没有连接`Zjut-stu`,一样地，一路选择下一步，最后会弹出一个无法加载的页面（显示域名为`172`开头的网页无法加载），此时**断开流量开关**，WIFI 连接`Zjut-stu`，微信右上角**刷新页面**，即可加载成功。接下来右侧业务办理处点击“用户注册开通”链接，弹出什么责任书，同意然后输入短信验证码，就开通成功了。最后再重新连接`Zjut-stu`，手机自带登录页面重新登录一次即可。
    

## 同时访问内外网

在此之前，你应该已经自助服务开通了校园网账号，并且你的**Windows电脑**应该能**单独访问内网**。

同时使用内网和外网（闪讯），考虑到成本，对于大多数笔记本，理想的连接方式就是内网用 WIFI，外网用闪讯，上面提到了，这样访问内网可能会比较慢（如果有两个有线网卡是最好的）

先插线连接闪讯，再连接名为 **Wlan-edu** 的WIFI，**管理员身份**打开 **Powershell**，输入 `ipconfig`，找到**无线局域网适配器 WLAN**的默认网关（如果默认网关为空，那就再等一下），也就是校园网的网关，记为`${网关IP}`

再输入`route print`，打开**路由表**，应该会看到类似以下的字样（顺序乱了没事）

```fallback
IPv4 路由表
===========================================================================
活动路由:
网络目标           网络掩码               网关               接口         跃点数
0.0.0.0           0.0.0.0            在链路上     115.200.94.163            36
0.0.0.0           0.0.0.0         172.28.0.1        172.28.94.29          4261
0.0.0.0           0.0.0.0           ${网关IP}         ${对应接口}          4556
```

### 原理

解释一下三个解析`0.0.0.0`的路由，接口`115`开头的是 NetKeeper 拨号的路由，`172`开头的是有线网卡的路由，他们两个负责解析**内外网 IP**。下面以`10`开头的是无线网卡的路由， 也负责解析内外网IP，因为跃点数越低的路由优先级越高，所以我们输入内网网址`192.168.210.112`时，负责解析的网关是 NetKeeper 的网关，那当然解析不到内网主机，下面将内网路由添加到**永久路由**（也叫静态路由，跃点数为 1，优先级最高），为了防止内网网口解析外网 IP，所以我们指定解析特定的 IP段。

### 具体实现

输入

```powershell
route delete 0.0.0.0 mask 255.255.128.0 ${对应接口}
#三个网关冲突了，所以选择删除内网路由
#注意中间空格
```

下面添加确定的 IP，专门使用内网连接

```powershell
route -p add 192.168.210.0 mask 255.255.255.0 ${网关IP}
# ${ip} 为网关 IP，请根据实际修改
# -p 是添加到永久路由的参数，拉高优先级，同时防止电脑重启后需要手动重新配置
#内网登录的 IP 为 192.168.210.112，以 192.168.210.0 为网络号有效避免与电脑上其他内网服务擦枪走火
```

当然还要添加`172`开头的内网 IP，因为选课的 IP 为`172.16.19.163`

```powershell
route -p add 172.0.0.0 mask 255.0.0.0 ${网关IP}
#这边没有考虑其他网卡需要访问172开头的IP，我寻思也用不到啊，如果需要，按照上面的步骤修改命令
```

上面添加的路由都会在**路由表**里面显示，如果觉得需要再次修改（删除再添加），请执行以下命令

```powershell
route -p delete ${负责解析的网络号/IP} mask ${子网掩码} ${网关IP}
#删除路由时三个参数要跟路由表里面的其中一条路由对应上，不然命令会执行失败
#含-p 是删除永久路由，如果要删除活动路由，则不需要加 -p
route -p add ${负责解析的网络号/IP} mask ${子网掩码} ${网关IP} #添加你想要的路由
```

然后去访问一下内网登录网页`192.168.210.112`，应该是能访问了。

以上只添加了`192.168.210`和`172.0.0.0`两个网络号，如果以后有内网的 IP 属于其他的网络号的话，手动添加到路由表里面

如果以后网关 IP 改变了，也需要修改路由表，不过网关应该是不会改的。

## 总结

电信在操作便捷性（定期换密码，手动设置内网）这块确实干不过移动😅，~~移动跟学校有py~~，但是其他方面是碾压的（延迟和实际网速）
